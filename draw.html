<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Drawing Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Toolbar Styling */
        .toolbar {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #f4f4f4;
            border-bottom: 1px solid #ccc;
        }

        .toolbar select,
        .toolbar button {
            padding: 5px;
            margin-right: 10px;
        }

        /* Page Container Styling */
        .page-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 60px);
            /* Adjust height to allow for the toolbar */
            background-color: #eaeaea;
        }

        /* Rulers Styling */
        .ruler {
            position: absolute;
            background-color: #ddd;
            font-size: 10px;
            color: #555;
        }

        .ruler.horizontal {
            top: 0;
            left: 50px;
            /* To accommodate the vertical ruler */
            right: 0;
            height: 50px;
            border-bottom: 1px solid #ccc;
        }

        .ruler.vertical {
            top: 50px;
            /* To accommodate the horizontal ruler */
            left: 0;
            bottom: 0;
            width: 50px;
            border-right: 1px solid #ccc;
        }

        .ruler .tick {
            position: absolute;
            background-color: #555;
        }

        /* Page Styling */
        .page {
            background-color: white;
            border: 1px solid #ccc;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Canvas Styling */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Draggable Tip Styling */
        .draggable-tip {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: blue;
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
        }

        /* Print Modal Styling */
        .print-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .print-modal.active {
            display: flex;
        }

        .print-modal-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body>

    <!-- Toolbar -->
    <div class="toolbar">
        <div>
            <label for="pageSize">Page Size:</label>
            <select id="pageSize">
                <option value="A4">A4</option>
                <option value="Letter">Letter</option>
                <option value="Legal">Legal</option>
            </select>
        </div>
        <div>
            <label for="units">Measurement Units:</label>
            <select id="units" disabled>
                <option value="feet">Feet</option>
            </select>
        </div>
        <div>
            <label for="lineThickness">Line Thickness:</label>
            <select id="lineThickness">
                <option value="2">2 px</option>
                <option value="4">4 px</option>
                <option value="6">6 px</option>
            </select>
        </div>
        <button id="printBtn">Print</button>
    </div>

    <!-- Print Modal -->
    <div class="print-modal" id="printModal">
        <div class="print-modal-content">
            <h3>Print Options</h3>
            <label>
                <input type="checkbox" id="printMeasurements" checked>
                Print Measurements
            </label><br>
            <label>
                <input type="checkbox" id="printTips" checked>
                Print Tips
            </label><br>
            <button id="confirmPrint">Print</button>
            <button id="cancelPrint">Cancel</button>
        </div>
    </div>

    <!-- Page Area with Rulers -->
    <div class="page-container">
        <!-- Top Ruler -->
        <div class="ruler horizontal" id="topRuler">
            <!-- Ticks will be generated by JavaScript -->
        </div>

        <!-- Left Ruler -->
        <div class="ruler vertical" id="leftRuler">
            <!-- Ticks will be generated by JavaScript -->
        </div>

        <!-- Page -->
        <div class="page" id="page">
            <canvas id="drawingCanvas"></canvas>
            <!-- Draggable Tips will be dynamically added here -->
        </div>
    </div>

    <script>
        // Initialize the map
        const page = document.getElementById('page');
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let isDragging = false;
        let dragLine = null;
        let lines = [];
        let shiftPressed = false;
        let lineThickness = 2; // Default line thickness

        // Scale factor: 1 inch = 220 feet, assuming 96 pixels per inch
        const scaleFactor = 220 / 96; // Approximately 2.2917 feet per pixel

        // Set initial page size to A4
        function setPageSize(size) {
            let width, height;
            switch (size) {
                case 'A4':
                    width = 210;
                    height = 297;
                    break;
                case 'Letter':
                    width = 216;
                    height = 279;
                    break;
                case 'Legal':
                    width = 216;
                    height = 356;
                    break;
                default:
                    width = 210;
                    height = 297;
            }
            page.style.width = `${width}mm`;
            page.style.height = `${height}mm`;
            // Adjust canvas size
            canvas.width = page.clientWidth;
            canvas.height = page.clientHeight;
            redrawCanvas();
            drawRulers();
        }

        // Initial page size setup
        setPageSize('A4');

        // Handle page size change
        document.getElementById('pageSize').addEventListener('change', function () {
            setPageSize(this.value);
        });

        // Handle line thickness change
        document.getElementById('lineThickness').addEventListener('change', function () {
            lineThickness = parseInt(this.value);
        });

        // Handle Shift key press for snapping
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Shift') {
                shiftPressed = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'Shift') {
                shiftPressed = false;
            }
        });

        // Mouse down event
        canvas.addEventListener('mousedown', (e) => {
            const { offsetX, offsetY } = e;
            // Check if clicking on a draggable tip
            const clickedTip = getClickedTip(offsetX, offsetY);
            if (clickedTip) {
                isDragging = true;
                dragLine = clickedTip;
                return;
            }
            isDrawing = true;
            const startX = offsetX;
            const startY = offsetY;
            lines.push({
                start: { x: startX, y: startY },
                end: { x: startX, y: startY },
                dragging: false
            });
        });

        // Mouse move event
        canvas.addEventListener('mousemove', (e) => {
            const { offsetX, offsetY } = e;
            if (isDrawing) {
                const currentLine = lines[lines.length - 1];
                let newX = offsetX;
                let newY = offsetY;

                // Snap to horizontal or vertical if Shift is pressed
                if (shiftPressed) {
                    if (Math.abs(offsetX - currentLine.start.x) > Math.abs(offsetY - currentLine.start.y)) {
                        newY = currentLine.start.y; // Snap to horizontal
                    } else {
                        newX = currentLine.start.x; // Snap to vertical
                    }
                }

                currentLine.end = { x: newX, y: newY };
                redrawCanvas();
                drawLines();
            } else if (isDragging && dragLine) {
                // Update the dragged endpoint
                dragLine.line[dragLine.point] = { x: offsetX, y: offsetY };
                redrawCanvas();
                drawLines();
            }
        });

        // Mouse up event
        canvas.addEventListener('mouseup', () => {
            if (isDrawing) {
                isDrawing = false;
                const currentLine = lines[lines.length - 1];
                drawTip(currentLine.end.x, currentLine.end.y);
                redrawCanvas();
            }
            isDragging = false;
            dragLine = null;
        });

        // Draw lines and measurements
        function drawLines() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.lineWidth = lineThickness;

            lines.forEach(line => {
                ctx.beginPath();
                ctx.moveTo(line.start.x, line.start.y);
                ctx.lineTo(line.end.x, line.end.y);
                ctx.strokeStyle = 'black';
                ctx.stroke();

                // Draw measurement text
                const length = getDistance(line.start, line.end) / scaleFactor;
                ctx.fillStyle = 'black';
                ctx.fillText(`${length.toFixed(2)} ft`, (line.start.x + line.end.x) / 2, (line.start.y + line.end.y) / 2 - 5);
            });
        }

        // Draw tips for line ends
        function drawTip(x, y) {
            const tip = document.createElement('div');
            tip.classList.add('draggable-tip');
            tip.style.left = `${x}px`;
            tip.style.top = `${y}px`;
            page.appendChild(tip);
            tip.addEventListener('mousedown', (e) => {
                e.stopPropagation(); // Prevent triggering canvas mousedown
                isDragging = true;
                dragLine = { line: lines[lines.length - 1], point: 'end' }; // Track which line end is being dragged
            });
            tip.addEventListener('mouseup', () => {
                isDragging = false;
                dragLine = null;
            });
        }

        // Get distance between two points
        function getDistance(start, end) {
            return Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
        }

        // Check if a tip was clicked
        function getClickedTip(x, y) {
            const tips = document.querySelectorAll('.draggable-tip');
            for (const tip of tips) {
                const tipRect = tip.getBoundingClientRect();
                if (x >= tipRect.left && x <= tipRect.right && y >= tipRect.top && y <= tipRect.bottom) {
                    return tip;
                }
            }
            return null;
        }

        // Print functionality
        document.getElementById('printBtn').addEventListener('click', () => {
            document.getElementById('printModal').classList.add('active');
        });

        document.getElementById('confirmPrint').addEventListener('click', () => {
            const printMeasurements = document.getElementById('printMeasurements').checked;
            const printTips = document.getElementById('printTips').checked;

            // Create a temporary canvas to draw for printing
            const printCanvas = document.createElement('canvas');
            const printCtx = printCanvas.getContext('2d');
            printCanvas.width = canvas.width;
            printCanvas.height = canvas.height;

            // Draw lines and measurements for printing
            printCtx.lineWidth = lineThickness;
            lines.forEach(line => {
                printCtx.beginPath();
                printCtx.moveTo(line.start.x, line.start.y);
                printCtx.lineTo(line.end.x, line.end.y);
                printCtx.strokeStyle = 'black';
                printCtx.stroke();

                // Print measurement text if selected
                if (printMeasurements) {
                    const length = getDistance(line.start, line.end) / scaleFactor;
                    printCtx.fillStyle = 'black';
                    printCtx.fillText(`${length.toFixed(2)} ft`, (line.start.x + line.end.x) / 2, (line.start.y + line.end.y) / 2 - 5);
                }
            });

            // Draw tips for printing if selected
            if (printTips) {
                const tips = document.querySelectorAll('.draggable-tip');
                tips.forEach(tip => {
                    const tipX = parseInt(tip.style.left);
                    const tipY = parseInt(tip.style.top);
                    printCtx.fillStyle = 'blue';
                    printCtx.beginPath();
                    printCtx.arc(tipX, tipY, 5, 0, Math.PI * 2);
                    printCtx.fill();
                });
            }

            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>Print</title></head><body>');
            printWindow.document.write('<img src="' + printCanvas.toDataURL() + '" style="width:100%; height:auto;"/>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
            document.getElementById('printModal').classList.remove('active');
        });

        document.getElementById('cancelPrint').addEventListener('click', () => {
            document.getElementById('printModal').classList.remove('active');
        });

        // Draw rulers
        function drawRulers() {
            drawHorizontalRuler();
            drawVerticalRuler();
        }

        // Draw horizontal ruler
        function drawHorizontalRuler() {
            const ruler = document.getElementById('topRuler');
            const tickCount = Math.floor(canvas.width / 20); // 20 px ticks
            ruler.innerHTML = ''; // Clear existing ticks

            for (let i = 0; i <= tickCount; i++) {
                const tick = document.createElement('div');
                tick.className = 'tick';
                tick.style.left = `${i * 20}px`;
                tick.style.height = '10px';
                tick.style.position = 'absolute';
                ruler.appendChild(tick);
            }
        }

        // Draw vertical ruler
        function drawVerticalRuler() {
            const ruler = document.getElementById('leftRuler');
            const tickCount = Math.floor(canvas.height / 20); // 20 px ticks
            ruler.innerHTML = ''; // Clear existing ticks

            for (let i = 0; i <= tickCount; i++) {
                const tick = document.createElement('div');
                tick.className = 'tick';
                tick.style.top = `${i * 20}px`;
                tick.style.width = '10px';
                tick.style.position = 'absolute';
                ruler.appendChild(tick);
            }
        }

        // Redraw canvas
        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawLines();
        }
    </script>

</body>

</html>